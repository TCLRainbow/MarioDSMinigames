var bal,bet,holdDraw,win=0,playerHand=[,,,,,],botHand=[,,,,,],ws=new WebSocket("ws"+document.location.origin.substring(4)+"/tables/picpoker/ws");ws.binaryType="arraybuffer";const symbols=["\u2B50","\uD83C\uDF4E","\uD83E\uDD52","\uD83C\uDF3B","\uD83C\uDF44","\u2601\uFE0F"];Object.seal(symbols);function addBet(){5>bet&&0<bal&&(bal--,bet++,document.getElementById("bal").textContent=bal,document.getElementById("bet display").textContent="\uD83D\uDCB0".repeat(bet),ws.send(new Uint8Array([32])))}function selectCard(a,b){a.target.style.backgroundColor=holdDraw&b?"":"black",holdDraw^=b,document.getElementById("next").textContent=0==holdDraw?"Hold":"Draw"}function unpack_hand(a,b){for(let c=0;5>c;c++)a[c]=symbols[7&b>>12-3*c]}function reset(){holdDraw=0,document.getElementById("next").textContent="Hold",document.getElementById("result").textContent="",document.getElementById("win counter").textContent=win,document.getElementById("hand sorted player").textContent=document.getElementById("hand sorted bot").textContent="",document.getElementById("hand bot").textContent="\uD83C\uDCCF \uD83C\uDCCF \uD83C\uDCCF \uD83C\uDCCF \uD83C\uDCCF",bet=20<=win?5:15<=win?4:10<=win?3:5<=win?2:1,document.getElementById("bet display").textContent="\uD83D\uDCB0".repeat(bet)}function main(){reset(),ws.onmessage=b=>{bal=0;let c=new Uint8Array(b.data);unpack_hand(playerHand,(c[0]<<8)+c[1]);for(let a=2;a<c.length;a++)bal=(bal<<8)+c[a];bal-=bet,document.getElementById("bal").textContent=bal,document.getElementById("hand player").textContent=playerHand.join("")}}function setResult(a,b){let c="";if(1==b){b=5==a[0][1]?16:4==a[0][1]?8:3==a[0][1]?2==a.length?6:4:2==a.length?3:2;let d=b*bet;c=`You win! (+${d})`,win++,bal+=d}else 0==b?(c="Draw!",bal+=bet):(c="You lose!",0<win&&win--);document.getElementById("bal").textContent=bal,document.getElementById("result").textContent=c}function getHandPattern(a){let b=new Map;a.forEach(a=>{let c=b.get(a);c===void 0?b.set(a,1):b.set(a,c+1)}),b=new Map([...b.entries()].sort((c,a)=>a[1]-c[1]));let c=[];for(let d of b.entries()){if(4<=d[1])return[d];if(3==d[1])c.push(d);else if(2==d[1])0==c.length?c.push(d):3==c[0][1]?c.push(d):symbols.indexOf(d[0])>symbols.indexOf(c[0][0])?c.push(d):c.unshift(d);else if(0==c.length)return[d]}return c}function proceed(a){if("Proceed"==a.target.textContent)return ws.send(new Uint8Array([64])),reset(),document.getElementById("bet button").style.visibility="visible",bal-=bet,document.getElementById("bal").textContent=bal,void(ws.onmessage=b=>{let c=new Uint8Array(b.data);unpack_hand(playerHand,(c[0]<<8)+c[1]),document.getElementById("hand player").textContent=playerHand.join("")});ws.send(new Uint8Array([holdDraw]));for(let b of document.getElementById("hold draw buttons").children)b.style.backgroundColor="";a.target.textContent="Proceed",document.getElementById("bet button").style.visibility="hidden",ws.onmessage=b=>{let c=new Uint8Array(b.data);unpack_hand(playerHand,(c[0]<<8)+c[1]),unpack_hand(botHand,(c[2]<<8)+c[3]),console.log(playerHand),0!=holdDraw&&(document.getElementById("hand player").textContent=playerHand.join("")),document.getElementById("hand bot").textContent=botHand.join("");let a=getHandPattern(playerHand);for(let c of a)document.getElementById("hand sorted player").textContent+=c[0].repeat(c[1]);botPattern=getHandPattern(botHand);for(let a of botPattern)document.getElementById("hand sorted bot").textContent+=a[0].repeat(a[1]);let d=0;c[0]>>7?d=1:c[2]>>7&&(d=-1),setResult(a,d)}}document.addEventListener("DOMContentLoaded",main);